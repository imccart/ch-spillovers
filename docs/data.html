<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data</title>

<script src="site_libs/header-attrs-2.14/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Health Care Specialization and Children's Hospitals</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li>
  <a href="data.html">Data</a>
</li>
<li>
  <a href="analysis.html">Analysis</a>
</li>
<li>
  <a href="papers.html">Papers</a>
</li>
<li>
  <a href="present.html">Presentations</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Data</h1>

</div>


<p>Our main data for this project come from the Health Care Cost
Institute (HCCI, version 1.0), and we supplement these data with
information about hospitals and hospital systems from the American
Hospital Association (AHA) annual surveys, the Hospital Cost Report
Information System (HCRIS), and market-level data from the American
Community Survey (ACS). Our main data and relevant code files are
discussed in more detail in the subsequent subsection.</p>
<div id="local-data-merged-to-hcci" class="section level2">
<h2>Local Data Merged to HCCI</h2>
<p>Due to restrictions on identifying hospital information, we first
created a hospital-level dataset which we provided to HCCI for
encryption. The encrypted version of these data was then made available
to use in the secure remote desktop environment, which we could merge to
the HCCI data based on the encrypted ID.</p>
<p>The <a href="data-code/local-aha-merge/_HospitalData.do">Hospital
Data</a> Stata file calls all subsequent code files and creates our
final hospital-level dataset. Individual code files called from this
main file include:</p>
<ol style="list-style-type: decimal">
<li><p><a href="data-code/local-aha-merge/1_AHA_Data.do">AHA Data</a>.
Hospital information from the AHA Annual Surveys.</p></li>
<li><p><a href="data-code/local-aha-merge/2_HCRIS_Data.do">HCRIS
Data</a>. Hospital information from the hospital cost reports. For more
details on the creation of the underlying cost report data, please see
the GitHub repo <a
href="https://github.com/imccart/HCRIS">here</a>.</p></li>
<li><p><a
href="data-code/local-aha-merge/3_Inpatient_PPS_Data.do">Inpatient PPS
Data</a>. Hospital information from the inpatient prospective payment
system final rule files. This information is ultimately not used in the
analysis.</p></li>
<li><p><a href="data-code/local-aha-merge/4_ACS_Data.do">ACS Data</a>.
County-level information (education, income, employment) from the
American Community Survey.</p></li>
<li><p><a href="data-code/local-aha-merge/5_CH_Tiers.do">CH Tiers</a>.
This calls a prior analysis, “AHA_tiers_merge.csv,” in which we first
delineated tiers of Children’s Hospitals. This paper can be found <a
href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC6986900/">here</a>.</p></li>
<li><p><a href="data-code/local-aha-merge/6_AMA_Data.do">AMA Data</a>.
This file incorporates purchased data on commercial insurance market
shares at the MSA level. This information was never used in our
analysis.</p></li>
</ol>
</div>
<div id="extracting-hcci-claims" class="section level2">
<h2>Extracting HCCI Claims</h2>
<p>The <a href="https://healthcostinstitute.org/">HCCI data</a> include
millions of commercial insurance claims and have become the
gold-standard for hospital pricing analysis. HCCI is transitioning to
Version 2.0 of the data, which consists of a different set of private
insurance contributors than we had available to use in Version 1.0.
Unfortunately, access to Version 1.0 expires for all researchers on
September 30, 2022, but the code used for our analysis would also apply
to Version 2.0.</p>
<ol style="list-style-type: decimal">
<li><p><a href="data-code/sas-build/_HCCI_01.sas">HCCI Data Part 1</a>.
This code file pulls all of the relevant pediatric HCCI claims from
Vertica, which is the data management software used at the time. This
file exports “ipclaims” and “opclaims” datasets for each year.</p></li>
<li><p><a href="data-code/sas-build/_HCCI_02.sas">HCCI Data Part 2</a>.
This code file creates inpatient admission data that we subsequently use
to calculate the share of pediatric procedures per hospital. The data
created from this file include all admissions, regardless of procedure.
This file exports “ipadmits” datasets for each year.</p></li>
</ol>
</div>
<div id="build-analytic-data" class="section level2">
<h2>Build analytic data</h2>
<p>We follow several steps to clean the resulting HCCI claims data and
merge additional variables, as described below:</p>
<ol style="list-style-type: decimal">
<li><p><a href="data-code/stata-build/_AdmitsIP.do">Total
Admissions</a>. Create a dataset of total inpatient admissions for each
hospital, “TotalHospitalAdmits.dta”. The file calls the following
individual code files.</p>
<ol style="list-style-type: lower-alpha">
<li><p><a href="data-code/stata-build/A1_AdmitsNPI.do">Admits NPI</a>
Drops observations with missing encrypted NPIs from <a
href="data-code/sas-build/_HCCI_02.sas">HCCI Data Part 2</a>. This file
exports a temporary “ipadmits” file for each year.</p></li>
<li><p><strong>AHA Match.</strong> Find matching hospitals between AHA
and HCCI data. This file requires some manual adjustments that may allow
individual hospitals to be identified from the code. As such, the
underlying code file cannot be posted or shared. Please feel free to
contact me for more details. This file uses the “ipadmits” temporary
data from the prior step, merges encrypted hospital IDs from HCCI, and
exports a set of temporary datasets,
“IPAdmits_AHA_2010”-“IPAdmits_AHA_2015”.</p></li>
<li><p><a href="data-code/stata-build/A3_UniqueAdmits.do">Unique
Admits</a>. Final data wrangling of the “IPAdmits_AHA” files, dropping
duplicate admits and other admissions with missing or questionable
diagnosis codes. Exports a set of temporary files for each year,
“CleanAdmits10” - “CleanAdmits15”.</p></li>
</ol></li>
<li><p><a href="data-code/stata-build/_ClaimsIP.do">Inpatient
Claims</a>. Creates a dataset of all inpatient claims and identifies
relevant pediatric procedures. Exports the claims data file,
“FinalInpatientData.dta”. The file calls the following individual code
files.</p>
<ol style="list-style-type: lower-alpha">
<li><p><a href="data-code/stata-build/ClaimsIP1_AdmitsNPI.do">IP Claims
Step 1</a>. Initial cleanup of the claims files created from <a
href="data-code/sas-build/_HCCI_01.sas">HCCI Data Part 1</a>, where we
drop observations with missing NPIs and irrelevant bill types. Exports a
set of temporary “ipclaims” files for each year.</p></li>
<li><p><strong>IP Claims Step 2.</strong> Find matching hospitals
between AHA and HCCI data. This file requires manual adjustments that
may facilitate the identification of individual hospitals and is
therefore omitted. The file uses “ipclaims” from step a and exports a
set of temporary datasets, “IPClaims_AHA_2010” - “IPClaims_AHA_2015”.
The file also exports a crosswalk file used to better match outpatient
facilities to inpatient (encrypted) NPIs.</p></li>
<li><p><a href="data-code/stata-build/ClaimsIP3_UniqueAdmits.do">IP
Claims Step 3</a>. Clean “IPClaims_AHA” files from step b and collapse
to admit level. Exports “CleanClaims10” - “CleanClaims15” data
files.</p></li>
<li><p><a href="data-code/stata-build/ClaimsIP4_DRG_LatLong.do">IP
Claims Step 4</a>. Incorporate drg weight information and the latitude
and longitude based on centroid of patient and hospital zip codes. Uses
the “CleanClaims” files from step c and exports “Inpatient_Analysis10” -
“Inpatient_Analysis15” data files.</p></li>
<li><p><a href="data-code/stata-build/ClaimsIP5_Distance.do">IP Claims
Step 5</a>. Calculate the distance between patient zip code centroid and
hospital zip code centroid. Exports a temporary “HospDistance” file for
each year.</p></li>
<li><p><a href="data-code/stata-build/ClaimsIP6_Prices.do">IP Claims
Step 6</a>. Uses the “Inpatient_Analysis” files from step d, merges the
distance from step e, drops outliers and transfers, and creates final
negotiated price variables. Exports “FinalInpatientData_2010” -
“FinalInpatientData_2015”.</p></li>
</ol></li>
<li><p><a href="data-code/stata-build/_ClaimsOP.do">Outpatient
Claims</a>. Mirrors the analysis of inpatient claims but for outpatient
data. As with the inpatient claims, there are 6 individual code files to
process the outpatient claims data. Exports the claims data file,
“FinalOutpatientData.dta”.</p></li>
<li><p><a href="data-code/stata-build/_HospitalData.do">Hospital
Data</a>. Takes as inputs the IPClaims_AHA and OPClaims_AHA files,
merges external hospital data from the Local Data section above, and
exports a final hospital-level dataset,
“AHA_ConsolidatedNPI_Data.dta.”</p></li>
<li><p><a href="data-code/stata-build/_FinalData.do">Final Claims
Data</a>. Create our final inpatient and outpatient claims files, which
we subsequently import into R for analysis. This file incorporates the
“FinalInpatientData.dta,” “FinalOutpatientData.dta,”
“TotalHospitalAdmits.dta,” “QualityData_IP.dta,” and
“QualityData_OP.dta” datasets, and calls the <a
href="data-code/stata-build/Pediatric_Index.do">Pediatric CCC Code</a>
to calculate the pediatric comorbidities index. The file exports two
datasets: “FinalData.txt” and “FinalData_All.txt”. The first is a subset
of the second, consisting only of the 13 routine pediatric procedures of
interest. The larger dataset is used to construct a starting point for
full hospital choice sets that include all hospitals that saw a
pediatric patient in a given year, rather than limited to only selected
pediatric procedures.</p></li>
<li><p><a href="data-code/stata-build/_ChoiceSets.do">Choice
Sets</a>.</p></li>
</ol>
</div>

<p class="footer" style="margin-top: 4em; font-size: 0.7em;">Copyright &copy; 2021 <a href="https://www.ianmccarthyecon.com/">Ian McCarthy</a>. Licensed under a <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.</p>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
